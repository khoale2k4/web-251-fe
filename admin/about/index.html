<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quản lý trang About - Admin</title>

  <!-- Tabler CSS -->
  <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta20/dist/css/tabler.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css" rel="stylesheet" />

  <!-- Sidebar cố định giống các trang admin khác -->
  <!-- Sidebar cố định REMOVED -->

  <style>
    .excerpt-preview {
      max-width: 320px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      color: #6c757d;
      font-size: 0.875rem;
    }

    .thumb-img {
      width: 64px;
      height: 40px;
      object-fit: cover;
      border-radius: 6px;
    }

    .text-monospace {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .navbar-vertical {
      background-color: #1e293b !important;
      color: white;
    }

    .navbar-vertical .nav-link,
    .navbar-vertical .nav-link-title,
    .navbar-vertical .nav-link-icon i {
      color: rgba(255, 255, 255, 0.85);
    }

    .navbar-vertical .nav-link.active {
      background: rgba(255, 255, 255, 0.15) !important;
      border-radius: 6px;
    }
  </style>
</head>

<body>
  <div class="page">
    <!-- Sidebar / header admin (giữ nguyên kiến trúc cũ) -->
    <div class="mount-admin-sidebar"></div>

    <!-- Nội dung chính -->
    <div class="page-wrapper">
      <div class="container-xl">
        <!-- Page header -->
        <div class="page-header d-print-none">
          <div class="row align-items-center">
            <div class="col">
              <h2 class="page-title">
                Quản lý nội dung trang About
              </h2>
              <div class="text-muted mt-1">
                Chỉnh sửa nội dung từ bảng page_contents &amp; các section từ bảng about_sections.
              </div>
            </div>
            <div class="col-auto ms-auto d-print-none">
              <div class="btn-list">
                <button id="btn-add-section" class="btn btn-primary">
                  <i class="ti ti-plus"></i>
                  Thêm section
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- CARD: Form quản lý page_contents (about_title, about_content, about_image) -->
        <div class="card mb-3">
          <form id="pageContentForm">
            <div class="card-header">
              <div class="row align-items-center">
                <div class="col">
                  <h3 class="card-title">Nội dung Trang giới thiệu (page_contents)</h3>
                  <div class="text-muted">
                    Tiêu đề, đoạn mô tả chính &amp; bộ ảnh đang dùng cho trang About của người dùng.
                  </div>
                </div>
                <div class="col-auto">
                  <span class="text-muted text-sm">
                    Lần cập nhật cuối:
                    <span id="lastUpdate" class="text-monospace">--</span>
                  </span>
                </div>
              </div>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label class="form-label">Tiêu đề (about_title)</label>
                <input type="text" class="form-control" id="aboutTitle" name="about_title">
              </div>
              <div class="mb-3">
                <label class="form-label">Nội dung (about_content)</label>
                <textarea class="form-control" id="aboutContent" name="about_content" rows="6"></textarea>
              </div>

              <div class="mb-3">
                <label class="form-label">Ảnh giới thiệu (about_image)</label>
                <div class="form-hint mb-2">
                  Tải lên ảnh mới. Ảnh sẽ được upload ngay lập tức.
                </div>
                <input type="file" class="form-control" id="aboutImageUpload" multiple
                  accept="image/png, image/jpeg, image/gif, image/webp">

                <div id="aboutImagePreview" class="mt-3 d-flex flex-wrap gap-2"></div>

                <input type="hidden" id="aboutImage" name="about_image">
              </div>
            </div>
            <div class="card-footer text-end">
              <button type="submit" class="btn btn-primary" id="btnSave">
                <i class="ti ti-device-floppy me-1"></i>
                Lưu thay đổi
              </button>
            </div>
          </form>
        </div>

        <!-- CARD: Bảng danh sách section About (about_sections) -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Danh sách section About</h3>
          </div>
          <div class="table-responsive">
            <table class="table table-vcenter card-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Tiêu đề</th>
                  <th>Mô tả ngắn</th>
                  <th>Hình ảnh</th>
                  <th>Thứ tự</th>
                  <th>Trạng thái</th>
                  <th class="w-1"></th>
                </tr>
              </thead>
              <tbody id="about-table-body">
                <tr>
                  <td colspan="7" class="text-center text-muted py-4">
                    Đang tải dữ liệu...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- PHÂN TRANG GIỐNG FAQ -->
          <div class="card-footer d-flex align-items-center">
            <p class="m-0 text-muted" id="aboutSummary">
              Chưa có section nào
            </p>
            <ul class="pagination m-0 ms-auto" id="aboutPagination"></ul>
          </div>
          <!-- HẾT PHÂN TRANG -->

        </div>

      </div>
    </div>
  </div>

  <!-- Modal thêm / sửa section -->
  <div class="modal fade" id="modal-about-form" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
      <div class="modal-content">
        <form id="about-form">
          <div class="modal-header">
            <h5 class="modal-title" id="about-form-title">Thêm section</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">

            <input type="hidden" id="about-id">

            <div class="mb-3">
              <label class="form-label">Tiêu đề</label>
              <input type="text" class="form-control" id="about-title-input" placeholder="Nhập tiêu đề section"
                required>
            </div>

            <div class="mb-3">
              <label class="form-label">Nội dung / mô tả</label>
              <textarea class="form-control" id="about-description-input" rows="4"
                placeholder="Mô tả chi tiết nội dung section"></textarea>
            </div>

            <div class="mb-3">
              <label class="form-label">URL hình ảnh</label>
              <input type="text" class="form-control" id="about-image-input" placeholder="Đường dẫn ảnh (image_url)">
              <div class="form-hint">
                Có thể là link tuyệt đối hoặc tương đối. Ví dụ:
                <code>/uploads/about/brand-story.jpg</code>
              </div>
            </div>

            <div class="row">
              <div class="col-sm-6 mb-3">
                <label class="form-label">Thứ tự hiển thị</label>
                <input type="number" class="form-control" id="about-sort-input" value="1" min="0" step="1">
              </div>
              <div class="col-sm-6 mb-3">
                <label class="form-label d-block">Trạng thái</label>
                <label class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="about-active-input" checked>
                  <span class="form-check-label">Hiển thị trên trang About</span>
                </label>
              </div>
            </div>

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-link link-secondary" data-bs-dismiss="modal">
              Hủy
            </button>
            <button type="submit" class="btn btn-primary">
              Lưu thay đổi
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal xác nhận xoá section -->
  <div class="modal fade" id="modal-about-delete" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-body text-center py-4">
          <h3>Bạn chắc chắn?</h3>
          <div class="text-secondary">
            Thao tác này sẽ xoá hẳn section khỏi trang About.
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn me-auto" data-bs-dismiss="modal">
            Hủy
          </button>
          <button type="button" class="btn btn-danger" id="btn-confirm-delete">
            Xoá
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- JS Tabler + sidebar + page -->
  <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta20/dist/js/tabler.min.js" defer></script>
  <!-- Config + Sidebar giống file settings -->
  <script type="module" src="../../js/config.js?v=6"></script>
  <script type="module">
    import { mountAdminSidebar } from '../../components/AdminSidebar.js';
    document.addEventListener('DOMContentLoaded', () => {
      // key 'pages' tuỳ bạn đặt để sidebar highlight đúng menu
      mountAdminSidebar('.mount-admin-sidebar', 'pages');
    });
  </script>
  <!-- JS riêng cho trang này -->
  <script type="module" src="./app.js"></script>

  <!-- ADMIN GUARD -->
  <script type="module" src="../js/admin-guard.js"></script>
</body>

</html>